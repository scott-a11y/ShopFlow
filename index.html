<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShopFlow - Door Production</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="header">
        <div>
            <h1>ShopFlow</h1>
            <div class="db-info" id="db-info">Loading...</div>
        </div>
        <div class="header-actions">
            <button class="btn" onclick="showImportModal()">üì• Import CSV</button>
            <button class="btn" onclick="saveJob()">üíæ Save Job</button>
            <button class="btn" onclick="loadJob()">üìÇ Load Job</button>
            <button class="btn" onclick="printCutList()">üñ®Ô∏è Cut List</button>
            <button class="btn btn-success" onclick="exportAllDXF()">üì§ Export All DXF</button>
        </div>
    </div>
    
    <div class="container">
        <!-- Job Info Bar -->
        <div class="job-info-bar">
            <div class="job-field">
                <label>Job #</label>
                <input type="text" id="job-number" placeholder="2024-001">
            </div>
            <div class="job-field">
                <label>Customer</label>
                <input type="text" id="customer-name" placeholder="Customer Name">
            </div>
            <div class="job-field">
                <label>Date</label>
                <input type="date" id="job-date">
            </div>
            <div class="job-field" style="flex:2;">
                <label>Notes</label>
                <input type="text" id="job-notes" placeholder="Kitchen reface, white shaker...">
            </div>
        </div>
        
        <!-- Stats Row -->
        <div class="stats-row">
            <div class="stat">
                <div class="stat-value" id="stat-parts">0</div>
                <div class="stat-label">Total Parts</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="stat-doors">0</div>
                <div class="stat-label">Doors</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="stat-drawers">0</div>
                <div class="stat-label">Drawer Fronts</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="stat-sqft">0</div>
                <div class="stat-label">Sq Ft</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="stat-sheets">0</div>
                <div class="stat-label">Sheets</div>
            </div>
        </div>
        
        <div class="grid">
            <!-- Left Panel -->
            <div class="left-panel">
                <!-- Hardware Selection -->
                <div class="card">
                    <div class="card-header">Hardware</div>
                    <div class="card-body">
                        <div class="tab-bar">
                            <div class="tab active" data-tab="hinge">Hinges</div>
                            <div class="tab" data-tab="slide">Slides</div>
                        </div>
                        <div id="tab-hinge" class="tab-content active">
                            <div class="search-box">
                                <input type="text" id="hinge-search" placeholder="Search hinges..." oninput="filterHardware('hinge')">
                            </div>
                            <div class="hardware-list" id="hinge-list"></div>
                        </div>
                        <div id="tab-slide" class="tab-content">
                            <div class="search-box">
                                <input type="text" id="slide-search" placeholder="Search slides..." oninput="filterHardware('slide')">
                            </div>
                            <div class="hardware-list" id="slide-list"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Hinge Configuration -->
                <div class="card">
                    <div class="card-header">Hinge Configuration</div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>Hinge Side</label>
                            <select id="hinge-side" onchange="updatePreview()">
                                <option value="left">Left</option>
                                <option value="right">Right</option>
                                <option value="both">Both (Double Door)</option>
                                <option value="top">Top (Flipper)</option>
                                <option value="bottom">Bottom (Tilt-out)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Vertical Template</label>
                            <select id="hinge-template" onchange="updateHingeTemplate()"></select>
                        </div>
                        <div class="form-group">
                            <label>Bottom Hinge (from bottom)</label>
                            <input type="text" id="bottom-hinge" value="3" onchange="drawPreview()" placeholder="3">
                        </div>
                        <div class="form-group">
                            <label>Top Hinge (from top)</label>
                            <input type="text" id="top-hinge" value="3" onchange="drawPreview()" placeholder="3">
                        </div>
                        <div class="form-group" style="margin-top:0.5rem;">
                            <label>Number of Hinges</label>
                            <select id="hinge-count" onchange="updatePreview()">
                                <option value="2">2 Hinges</option>
                                <option value="3">3 Hinges</option>
                                <option value="4">4 Hinges</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin-top:0.5rem;">
                            <label>Profile Cut</label>
                            <select id="profile-tool" onchange="updatePreview()">
                                <option value="Fast Cut">Fast Cut (standard)</option>
                                <option value="Slow Cut">Slow Cut (onion skin)</option>
                                <option value="Medium Cut">Medium Cut</option>
                                <option value="Micro Cut">Micro Cut (small parts)</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Settings -->
                <div class="card">
                    <div class="card-header">Settings</div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>Display Units</label>
                            <select id="display-units" onchange="updateUnits()">
                                <option value="fraction">Imperial Fractions (15-1/2")</option>
                                <option value="decimal">Decimal Inches (15.5")</option>
                                <option value="metric">Metric (393.7mm)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Material Thickness</label>
                            <select id="material-thickness">
                                <option value="0.75">3/4" (19mm)</option>
                                <option value="0.625">5/8" (16mm)</option>
                                <option value="0.5">1/2" (12.7mm)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Sheet Size</label>
                            <select id="sheet-size" onchange="updateStats()">
                                <option value="32">4' √ó 8' (32 sq ft)</option>
                                <option value="40">5' √ó 8' (40 sq ft)</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Center Panel - Preview -->
            <div class="center-panel">
                <div class="card preview-card">
                    <div class="card-header">
                        <span>Preview</span>
                        <select id="preview-select" onchange="updatePreview()"></select>
                    </div>
                    <div class="card-body">
                        <div class="preview-container" id="preview-container">
                            <canvas id="preview"></canvas>
                        </div>
                        <div class="preview-controls">
                            <button class="btn btn-primary" onclick="exportSelectedDXF()">Export DXF</button>
                            <button class="btn" onclick="zoomIn()">üîç+</button>
                            <button class="btn" onclick="zoomOut()">üîç-</button>
                            <button class="btn" onclick="resetZoom()">‚Ü∫</button>
                            <button class="btn active" id="btn-dimensions" onclick="toggleDimensions()">üìè Dims</button>
                            <button class="btn" id="btn-measure" onclick="toggleMeasure()">üìê Measure</button>
                        </div>
                        <div class="measure-result" id="measure-result">Drag to pan ‚Üí Scroll to zoom</div>
                    </div>
                </div>
                
                <!-- Measure Panel -->
                <div class="measure-panel" id="measure-panel" style="display:none;">
                    <div class="measure-panel-header">
                        <span>üìê Measure / Inspect</span>
                        <button onclick="closeMeasurePanel()" class="measure-close">√ó</button>
                    </div>
                    <div class="measure-panel-body">
                        <div class="measure-row">
                            <label>Distance:</label>
                            <span id="m-distance">‚Äî</span>
                        </div>
                        <div class="measure-row">
                            <label>Angle:</label>
                            <span id="m-angle">‚Äî</span>
                        </div>
                        <div class="measure-row">
                            <label>X Distance:</label>
                            <span id="m-dx">‚Äî</span>
                        </div>
                        <div class="measure-row">
                            <label>Y Distance:</label>
                            <span id="m-dy">‚Äî</span>
                        </div>
                        <hr>
                        <div class="measure-row">
                            <label>Point 1:</label>
                            <span id="m-pt1">‚Äî</span>
                        </div>
                        <div class="measure-row">
                            <label>Point 2:</label>
                            <span id="m-pt2">‚Äî</span>
                        </div>
                        <hr>
                        <div class="measure-row">
                            <label>Cursor:</label>
                            <span id="m-cursor">‚Äî</span>
                        </div>
                        <div class="measure-row snap-indicator" id="m-snap-row">
                            <label>Snap:</label>
                            <span id="m-snap">None</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Panel - Parts List -->
            <div class="right-panel">
                <div class="card parts-card">
                    <div class="card-header">
                        <span>Parts List</span>
                        <div class="parts-header-controls">
                            <label class="group-toggle">
                                <input type="checkbox" id="group-parts" onchange="renderParts()"> Group
                            </label>
                            <button class="btn btn-sm" onclick="clearAllParts()">Clear</button>
                            <button class="btn btn-primary btn-sm" onclick="addPart()">+ Add</button>
                        </div>
                    </div>
                    <div class="card-body" style="padding:0;">
                        <div class="parts-scroll">
                            <table class="parts-table">
                                <thead>
                                    <tr>
                                        <th style="width:22px;"></th>
                                        <th class="col-name">Name</th>
                                        <th class="col-room">Room</th>
                                        <th class="col-cabinet">Cabinet</th>
                                        <th style="width:55px;">W</th>
                                        <th style="width:55px;">H</th>
                                        <th style="width:55px;">Type</th>
                                        <th style="width:40px;">Side</th>
                                        <th style="width:22px;"></th>
                                    </tr>
                                </thead>
                                <tbody id="parts-tbody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Import Modal -->
    <div id="import-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Import Parts from CSV</h3>
                <button onclick="hideImportModal()" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Paste CSV data or upload a file:</p>
                <code>Name, Width, Height, Type, HingeSide, Room, Cabinet</code>
                <p class="hint">
                    Width/Height: fractions (15-1/2) or decimals (15.5)<br>
                    Type: door or drawer<br>
                    HingeSide: left, right, both (optional)<br>
                    Room &amp; Cabinet: for grouping (optional)
                </p>
                <textarea id="csv-input" placeholder="Upper Left, 15-1/2, 30, door, left, Kitchen, Base 1
Upper Right, 15-1/2, 30, door, right, Kitchen, Base 1
Drawer 1, 18, 6, drawer, , Kitchen, Base 2
Vanity Door, 18, 24, door, left, Master Bath, Vanity"></textarea>
                <div style="margin-top:0.5rem;">
                    <input type="file" id="csv-file" accept=".csv,.txt" onchange="loadCSVFile(event)">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="hideImportModal()">Cancel</button>
                <button class="btn btn-primary" onclick="importCSV()">Import</button>
            </div>
        </div>
    </div>
    
    <script src="js/app.js"></script>
</body>
</html>
